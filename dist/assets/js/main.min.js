"use strict";var lastEvent,touchmovezone,touchmovectx,color=$(".selected").css("background-color"),$canvas=$("canvas"),controlsSection=$(".controls"),context=$canvas[0].getContext("2d"),lastPt=null,mouseDown=!1,stroke=12,opacityVal=100;function changeStroke(){stroke=$(this).val(),$("#strokeVal").text(stroke+" px"),$("#strokeBox").width(stroke),$("#strokeBox").height(stroke),$("#shadowBrush").css({width:stroke,height:stroke})}function hexToRgb(o){o=o.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(o,t,e,c){return t+t+e+e+c+c});var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(o);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}opacityVal/=100,$("#shadowBrush").css({width:stroke,height:stroke,backgroundColor:color,borderColor:color}),$("#strokeVal").text(stroke+" px"),$("#strokeBox").width(stroke).height(stroke).css("background-color",color),$("#opacityVal").text(opacityVal),$(window).on("resize load",function(){context.canvas.width=$(window).width(),context.canvas.height=$(window).height()}),$(".btn-controls").on("click",function(){controlsSection.toggleClass("open close"),controlsSection.hasClass("open")?($(this).find("span").text("-"),$(this).css({"background-color":"#fff",color:"#000"}),$("canvas").click(function(){controlsSection.removeClass("open"),controlsSection.addClass("close"),$(".btn-controls").css({"background-color":"#000",color:"#fff"}).find("span").text("+")})):($(this).find("span").text("+"),$(this).css({"background-color":"#000",color:"#fff"}))}),$(".btn-random").click(function(){var o=Math.floor(255*Math.random()+1)+","+Math.floor(255*Math.random()+1)+","+Math.floor(255*Math.random()+1)+", 1";$(".selected").css("background-color","rgba("+o+")"),color=$(".selected").css("background-color"),$("#shadowBrush").css({backgroundColor:"rgba("+o+")",borderColor:color})}),controlsSection.on("click","li",function(){$(".controls li").removeClass("selected"),$(this).addClass("selected"),color=$(this).css("background-color"),$("#strokeBox").css("background-color",color),$(this).hasClass("white")?($("#colorPicker").attr("disabled",!0),stroke=50,$("#strokeVal").text(stroke+" px"),$("#strokeBox").width(stroke),$("#strokeBox").height(stroke),$("#stroke").val(50)):$("#colorPicker").attr("disabled",!1)});var bgColor=$(".selected").css("background-color");function changeOpacity(){var o;opacityVal=$(this).val()/100,console.log("opacityVal: ",opacityVal),console.log("bgColor: ",bgColor),o=String(bgColor).includes("rgb")?bgColor.split("(").pop().split(")")[0]:hexToRgb(bgColor),console.log("hex: ",o),$(".selected").css("background-color","rgba("+o+","+opacityVal+")"),color=$(".selected").css("background-color"),console.log("color: ",color),$("#opacityVal").text(opacityVal)}function initTouchMoveCanvas(){(touchmovezone=document.getElementById("canvas")).addEventListener("touchmove",drawTouchMove,!1),touchmovezone.addEventListener("touchend",endTouchMove,!1),touchmovezone.addEventListener("mousedown",function(){touchmovezone.addEventListener("mousemove",drawMouseMove,!1)},!1),touchmovezone.addEventListener("mouseup",endMouseMove,!1),touchmovectx=touchmovezone.getContext("2d")}function drawTouchMove(o){o.preventDefault();var t=$canvas.offset();null!==lastPt&&(touchmovectx.beginPath(),touchmovectx.strokeStyle=color,touchmovectx.lineWidth=stroke,touchmovectx.lineCap="round",touchmovectx.lineJoin="round",touchmovectx.moveTo(lastPt.x-t.left,lastPt.y-t.top),touchmovectx.lineTo(o.touches[0].pageX-t.left,o.touches[0].pageY-t.top),touchmovectx.stroke()),lastPt={x:o.touches[0].pageX,y:o.touches[0].pageY}}function drawMouseMove(o){o.preventDefault();var t=$canvas.offset();null!==lastPt&&(touchmovectx.beginPath(),touchmovectx.strokeStyle=color,touchmovectx.lineWidth=stroke,touchmovectx.lineCap="round",touchmovectx.moveTo(lastPt.x-t.left,lastPt.y-t.top),touchmovectx.lineTo(o.pageX-t.left,o.pageY-t.top),touchmovectx.stroke()),lastPt={x:o.pageX,y:o.pageY}}function endTouchMove(o){o.preventDefault(),lastPt=null}function endMouseMove(o){o.preventDefault(),touchmovezone.removeEventListener("mousemove",drawMouseMove,!1),lastPt=null}function save(){document.getElementById("canvasimg").style.border="2px solid";var o=canvas.toDataURL();document.getElementById("canvasimg").src=o,document.getElementById("canvasimg").style.display="inline"}$("#stroke").on("input",changeStroke),$("#opacity").on("input",changeOpacity),$("#addNewColor").click(function(){var o=$("<li></li>");o.css("background-color",$("#colorPicker").val()),$(".color-picker").append(o),o.click()}),$("#clear, .btn-clear").click(function(){context.canvas.width=$(window).width(),context.beginPath()});