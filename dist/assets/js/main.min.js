function changeColor(){var o=$("#red").val(),e=$("#green").val(),t=$("#blue").val(),c=$("#opacity").val()/100;$("#newColor").css("background-color","rgba("+o+","+e+", "+t+", "+c+")")}function changeStroke(){stroke=$(this).val(),$("#strokeVal").text(stroke+" px"),$("#strokeBox").width(stroke),$("#strokeBox").height(stroke)}function hexToRgb(o){var e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;o=o.replace(e,function(o,e,t,c){return e+e+t+t+c+c});var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(o);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function changeOpacity(){opacityVal=$(this).val()/100;var o=hexToRgb(bgcolor);$(".selected").css("background-color","rgba("+o+","+opacityVal+")"),color=$(".selected").css("background-color"),$("#opacityVal").text(opacityVal)}function initTouchMoveCanvas(){touchmovezone=document.getElementById("canvas"),touchmovezone.addEventListener("touchmove",drawtouchmove,!1),touchmovezone.addEventListener("touchend",endtouchmove,!1),touchmovezone.addEventListener("mousedown",function(){touchmovezone.addEventListener("mousemove",drawmousemove,!1)},!1),touchmovezone.addEventListener("mouseup",endmousemove,!1),touchmovectx=touchmovezone.getContext("2d")}function drawtouchmove(o){o.preventDefault();var e=$canvas.offset();null!==lastPt&&(touchmovectx.beginPath(),touchmovectx.strokeStyle=color,touchmovectx.lineWidth=stroke,touchmovectx.lineCap="round",touchmovectx.lineJoin="round",touchmovectx.moveTo(lastPt.x-e.left,lastPt.y-e.top),touchmovectx.lineTo(o.touches[0].pageX-e.left,o.touches[0].pageY-e.top),touchmovectx.stroke()),lastPt={x:o.touches[0].pageX,y:o.touches[0].pageY}}function drawmousemove(o){o.preventDefault();var e=$canvas.offset();null!==lastPt&&(touchmovectx.beginPath(),touchmovectx.strokeStyle=color,touchmovectx.lineWidth=stroke,touchmovectx.lineCap="round",touchmovectx.moveTo(lastPt.x-e.left,lastPt.y-e.top),touchmovectx.lineTo(o.pageX-e.left,o.pageY-e.top),touchmovectx.stroke()),lastPt={x:o.pageX,y:o.pageY}}function endtouchmove(o){o.preventDefault(),lastPt=null}function endmousemove(o){o.preventDefault(),touchmovezone.removeEventListener("mousemove",drawmousemove,!1),lastPt=null}var color=$(".selected").css("background-color"),$canvas=$("canvas"),controlsSection=$(".controls"),context=$canvas[0].getContext("2d"),lastEvent,touchmovezone,touchmovectx,lastPt=null,mouseDown=!1,stroke=2,opacityVal=100;opacityVal/=100,$("#strokeVal").text(stroke+" px"),$("#strokeBox").width(stroke).height(stroke).css("background-color",color),$("#opacityVal").text(opacityVal),$(window).on("resize load",function(){context.canvas.width=$(window).width(),context.canvas.height=$(window).height()}),$(".controls-btn").on("click",function(){controlsSection.toggleClass("open close"),controlsSection.hasClass("open")?$(this).text("-").css({"background-color":"#fff",color:"#000"}):($(this).text("+").css({"background-color":"#000",color:"#fff"}),$("#colorSelect").slideUp())}),controlsSection.on("click","li",function(){$(".controls li").removeClass("selected"),$(this).addClass("selected"),color=$(this).css("background-color"),$("#strokeBox").css("background-color",color),$(this).hasClass("white")?($("#revealColorSelect").attr("disabled",!0),stroke=50,$("#strokeVal").text(stroke+" px"),$("#strokeBox").width(stroke),$("#strokeBox").height(stroke)):$("#revealColorSelect").attr("disabled",!1)}),$("#revealColorSelect").click(function(){changeColor(),$("#colorSelect").slideToggle()});var bgcolor=$(".selected").css("background-color");$("#stroke").change(changeStroke),$(".sliders input[type=range]").change(changeColor),$("#opacity").change(changeOpacity),$("#addNewColor").click(function(){var o=$("<li></li>");o.css("background-color",$("#newColor").css("background-color")),$(".color-picker").append(o),o.click()}),$("#clear").click(function(){context.canvas.width=$(window).width(),context.beginPath()});